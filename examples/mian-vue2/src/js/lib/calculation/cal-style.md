# SCM8 计算公式

# 修改非税单价

非税金额 = 非税单价 _ 数量
含税金额
|- 价外税 = 非税金额 _ (1 + 税率)
+- 价内税 = 非税金额 / (1 - 税率)
含税单价
|- 数量非零 = 含税金额 / 数量
+- 数量为零
|- 价外税 = 非税单价 \* (1 + 税率)
+- 价内税 = 非税单价 / (1 - 税率)
税 额 = 含税金额 - 非税金额

# 修改数量

非税金额 = 非税单价 _ 数量
含税金额 = 含税单价 _ 数量
税 额 = 含税金额 - 非税金额

# 修改非税金额

数量为零，非税金额录入后自动变为 0

非税单价 = 非税金额 / 数量
含税金额
|- 价外税 = 非税金额 \* (1 + 税率）
+- 价内税 = 非税金额 / (1 - 税率）
含税单价 = 含税金额 / 数量
税 额 = 含税金额 - 非税金额

# 修改含税金额

数量为零，含税金额金额不允许修改

含税单价 = 含税金额 / 数量
非税金额
|- 价外税 = 含税金额 / (1 + 税率）
+- 价内税 = 含税金额 \* (1 - 税率）
非税单价 = 非税金额 / 数量
税 额 = 含税金额 - 非税金额

# 修改含税金额(财务模块使用)

非税金额 = 含税金额 - 税 额

数量为零，含税单价 非税单价 不计算

含税单价 = 含税金额 / 数量
非税单价 = 非税金额 / 数量

# 修改税额(财务模块使用)

非税金额 = 含税金额 - 税 额

数量为零，含税单价 非税单价 不计算

含税单价 = 含税金额 / 数量
非税单价 = 非税金额 / 数量

# 修改含税单价

含税金额 = 含税单价 _ 数量
非税金额
|-价外税 = 含税金额 / (1 + 税率)
+-价内税 = 含税金额 _ (1 - 税率)
非税单价
|- 数量非零 = 非税金额 / 数量
+- 数量为零
|- 价外税 = 含税单价 / (1 + 税率)
+- 价内税 = 含税单价 \* (1 - 税率)
税 额 = 含税金额 - 非税金额

# 修改单位

此计算方式为了和云供应链门店自采入库计算规则一致, 改为以下规则

含税单价 = 原含税单价 \* 新单位换算率 / 旧单位换算率

=> 执行修改含税单价逻辑

=> 执行修改数量逻辑

# 修改税率

=> 执行修改含税单价逻辑

# 设置赠品

价格 = 0
税率 = 0

=> 执行修改非税单价逻辑

# 业务单位与辅助单位一致时，修改辅助数量

数量 = 辅助数量

=> 执行修改数量逻辑

# 修改折扣率

折扣额 = 数量 \* 含税单价 \*（ 折扣率 / 100 ）
含税金额（价税合计） = 数量 \* 含税单价 - 折扣额
非税金额 = 数量 \* 非税单价 \*（ 1 - 折扣率 / 100 ）
税额 = 含税金额 - 非税金额

# 修改折扣额

折扣率 = 折扣额 \* 100 / 数量 / 含税单价
含税金额（价税合计） = 数量 \* 含税单价 - 折扣额
非税金额 = 数量 \* 非税单价 \*（ 1 - 折扣率 / 100 ）
税额 = 含税金额 - 非税金额